# TraceLogKit - 环境变量示例文件
# 复制此文件为 `.env` 并根据需要进行调整。
#
# 本项目提供了一套可观测性堆栈 (Grafana + Tempo + Prometheus + OTel Collector + Loki/Promtail)。
# TraceLogKit 使用独立的 Docker 网络（默认：`tracelogkit-network`），
# 如果需要监控其他项目的服务，请确保这些服务也在同一个 Docker 网络中。

# =========================
# 核心必需配置
# =========================
# 以下配置是 TraceLogKit 运行所必需的

# 时区设置
TZ=Asia/Shanghai
PGTZ=Asia/Shanghai

# Grafana 管理员凭据
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin

# TraceLogKit Docker 网络名称
# 确保与您的应用服务在同一 Docker 网络中
TRACELOGKIT_NETWORK_NAME=tracelogkit-network

# Loki 服务地址（用于 Promtail 推送日志）
# 本地部署：http://tracelogkit-loki:3100（Docker 网络内）或 http://localhost:3100
# 远程部署：http://loki-server-ip:3100 或 http://loki.example.com:3100
LOKI_URL=http://tracelogkit-loki:3100

# Promtail 容器过滤配置（必需，白名单模式）
# 如果同一台服务器有多个项目的容器，必须通过以下方式指定要收集哪些容器
# 如果不配置任何过滤规则，Promtail 默认不收集任何容器的日志（白名单模式）
#
# Promtail 上报到 Loki 的数据约束（重要）：
# - 只会上报“日志内容本身是 JSON 字符串”的行；非 JSON 行会被丢弃
# - 必须在 JSON 中包含字段 service（值为客户端容器名称）
# - project 标签由 service 派生：project = service 在第一个 '-' 之前的前缀
# - 最终写入 Loki 的标签只有 project（不会写入 job/container/compose_* 等标签）

# 方式 1：按容器名称列表过滤（精确匹配，逗号分隔，"或"关系）
# 例如：只收集名为 "a"、"b"、"my-app" 的容器（只要匹配其中一个就收集）
# PROMTAIL_CONTAINER_NAMES=a,b,my-app

# 方式 2：按容器名称模式过滤（正则表达式）
# 例如：只收集名称以 "my-app-" 开头的容器
# PROMTAIL_CONTAINER_NAME_PATTERN=my-app-.*

# 方式 3：按 Docker Compose 项目名称过滤
# 例如：只收集项目名为 "my-project" 的容器
# PROMTAIL_COMPOSE_PROJECT=my-project

# 方式 4：按 Docker Compose 服务名称过滤（逗号分隔）
# 例如：只收集服务名为 "api" 或 "worker" 的容器
# PROMTAIL_COMPOSE_SERVICE=api,worker

# 过滤逻辑说明：
# - 方式 1 是"或"关系：只要容器名匹配列表中的任意一个就收集
# - 方式 2、3、4 之间是"与"关系：必须同时满足所有配置的条件才收集
# - 如果同时配置了方式 1 和其他方式，容器需要满足：方式 1 的"或"条件 或 (方式 2、3、4 的"与"条件)
PROMTAIL_CONTAINER_NAMES=
PROMTAIL_CONTAINER_NAME_PATTERN=
PROMTAIL_COMPOSE_PROJECT=
PROMTAIL_COMPOSE_SERVICE=

# 可选的代理设置（本地开发环境可留空）
HTTP_PROXY=
HTTPS_PROXY=
NO_PROXY=localhost,127.0.0.1,tracelogkit-tempo,tracelogkit-loki,tracelogkit-grafana,tracelogkit-prometheus,tracelogkit-otel-collector,tracelogkit-network
no_proxy=localhost,127.0.0.1,tracelogkit-tempo,tracelogkit-loki,tracelogkit-grafana,tracelogkit-prometheus,tracelogkit-otel-collector,tracelogkit-network

# =========================
# Loki 存储配置
# =========================
# Loki 的存储分为两部分：
# 1. 索引存储（index store）：用于存储日志索引（仅支持 boltdb-shipper，使用文件系统）
# 2. 对象存储（object store）：用于存储日志数据

# 索引存储类型: boltdb-shipper（默认，唯一支持的类型）
# - boltdb-shipper: Loki 使用 BoltDB 作为索引存储（文件系统，无需额外配置）
# 注意：Loki 的索引存储不支持 PostgreSQL 和 MySQL，只能使用 boltdb-shipper
LOKI_INDEX_STORE_TYPE=boltdb-shipper

# 对象存储类型: filesystem（默认，开发环境）或 s3（生产环境）
LOKI_OBJECT_STORE_TYPE=filesystem

# S3 对象存储配置（当 LOKI_OBJECT_STORE_TYPE=s3 时使用）
# 支持 MinIO、AWS S3、阿里云 OSS (S3 兼容)
# 如果使用 filesystem 对象存储，以下配置可以留空
LOKI_S3_ENDPOINT=
LOKI_S3_REGION=
LOKI_S3_BUCKET_NAME=
LOKI_S3_ACCESS_KEY=
LOKI_S3_SECRET_KEY=
LOKI_S3_FORCE_PATH_STYLE=true
LOKI_S3_INSECURE=true

# =========================
# PostgreSQL 数据库配置（可选）
# =========================
# **重要说明**：
# - PostgreSQL 配置用于应用数据库、Prometheus 监控等用途
# - **不用于 Loki 索引存储**（Loki 的索引存储仅支持 boltdb-shipper，不支持 PostgreSQL/MySQL）
# - 如果项目中有 docker/postgres/ 目录，这些配置用于 PostgreSQL 主从库容器
# - 如果不需要 PostgreSQL，可以留空

# PostgreSQL 主库配置（用于写入）
# 开发环境：使用 Docker 容器名（如 tracelogkit-postgres-primary）
# 生产环境：使用实际服务器 IP 或域名
DB_WRITE_HOST=tracelogkit-postgres-primary
# 连接端口：Docker 网络内使用 5432，外部服务器使用实际端口
DB_WRITE_PORT=5432
DB_WRITE_USER=admin
DB_WRITE_PASSWORD=admin
DB_WRITE_DB=admin

# PostgreSQL 从库配置（用于读取，读写分离）
# 开发环境：使用 Docker 容器名（如 tracelogkit-postgres-replica）
# 生产环境：使用实际服务器 IP 或域名
DB_READ_HOST=tracelogkit-postgres-replica
# 连接端口：Docker 网络内使用 5432，外部服务器使用实际端口
DB_READ_PORT=5432
DB_READ_USER=admin
DB_READ_PASSWORD=admin
# 重要：主从库必须使用相同的数据库名才能进行主从同步
DB_READ_DB=admin

# PostgreSQL 主从复制配置（用于主从库之间的数据同步）
DB_REPLICATION_USER=repl_user
DB_REPLICATION_PASSWORD=repl_password

# =========================
# Prometheus 服务发现配置（可选）
# =========================
# **注意**：只有在使用 Consul 服务发现时才需要配置。
# 如果不使用 Consul，将以下配置留空即可，Prometheus 仍然可以启动，只是相关 job 会报连接失败日志。

# Consul 服务发现配置（可选）
# 用于 Prometheus 通过 Consul 自动发现和抓取服务指标（如 api-gateway、model-forwarder）
# 如果需要使用 Consul，填写以下配置；如果不需要，留空即可
CONSUL_HOST=
CONSUL_PORT=
